<div class="modal-backdrop" (click)="onClose()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Cambiar Contraseña</h3>
            <button class="close-btn" (click)="onClose()">&times;</button>
        </div>
        
        <div class="modal-body">
            <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
            <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

            <form [formGroup]="form" (ngSubmit)="onSubmit()">
                <div class="form-group">
                    <label>Contraseña Actual</label>
                    <input type="password" formControlName="oldPassword" class="form-control" 
                           [class.is-invalid]="form.get('oldPassword')?.touched && form.get('oldPassword')?.invalid">
                </div>

                <div class="form-group">
                    <label>Nueva Contraseña</label>
                    <input type="password" formControlName="newPassword" class="form-control"
                           [class.is-invalid]="form.get('newPassword')?.touched && form.get('newPassword')?.invalid">
                    <div class="invalid-feedback" *ngIf="form.get('newPassword')?.errors?.['minlength']">
                        Mínimo 6 caracteres
                    </div>
                </div>

                <div class="form-group">
                    <label>Confirmar Nueva Contraseña</label>
                    <input type="password" formControlName="confirmPassword" class="form-control"
                        [class.is-invalid]="form.hasError('mismatch') && form.get('confirmPassword')?.touched">
                    <div class="invalid-feedback" *ngIf="form.hasError('mismatch')">
                        Las contraseñas no coinciden
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" (click)="onClose()">Cancelar</button>
                    <button type="submit" class="btn btn-primary" [disabled]="form.invalid || loading">
                        <span *ngIf="loading" class="spinner-border spinner-border-sm"></span>
                        {{ loading ? 'Guardando...' : 'Guardar' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
