<div class="d-flex flex-column min-vh-100 bg-light position-relative">
  <!-- Loading Overlay -->
  <div *ngIf="showLoading"
    class="position-absolute top-0 start-0 w-100 h-100 bg-white d-flex flex-column justify-content-center align-items-center z-3"
    style="z-index: 1050;">
    <div class="mb-4">
      <img src="logoCompleto4V.png" alt="Cuatrovientos" style="max-width: 250px; animation: pulse 2s infinite;">
    </div>
    <div class="spinner-border text-custom-blue" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <h5 class="mt-3 text-muted fw-light">Cargando datos...</h5>
  </div>

  <app-navbar></app-navbar>
  <div class="d-flex flex-grow-1 overflow-hidden">
    <app-sidebar></app-sidebar>
    <div class="flex-grow-1 overflow-auto">
      <div class="container-fluid p-4">
        <div class="d-flex flex-column align-items-center mb-5">
          <h2 class="text-custom-blue fw-bold">Dashboard</h2>
        </div>

        <!-- Top Cards Row 1: Entities & Active -->
        <div class="row g-4 mb-4">
          <!-- Volunteers -->
          <div class="col-md-4">
            <app-stat-card title="VOLUNTARIOS" [value]="volunteersTotal"
              [subtext]="'+' + volunteersPending + ' Pendientes'" icon="bi-people"
              iconBgColor="bg-primary"></app-stat-card>
          </div>
          <!-- Matches (Active/Accepted + Pending) -->
          <div class="col-md-4">
            <app-stat-card title="MATCHES ACTIVOS" [value]="matchesAccepted"
              [subtext]="'+' + matchesPending + ' Pendientes'" icon="bi-link" iconBgColor="bg-primary"></app-stat-card>
          </div>
          <!-- Activities (Active + Pending) -->
          <div class="col-md-4">
            <app-stat-card title="VOLUNTARIADOS ACTIVOS" [value]="activitiesActive"
              [subtext]="'+' + activitiesPending + ' Pendientes'" icon="bi-heart"
              iconBgColor="bg-primary"></app-stat-card>
          </div>
        </div>

        <!-- Top Cards Row 2: Status & Completed -->
        <div class="row g-4 mb-4">
          <!-- Organizations -->
          <div class="col-md-4">
            <app-stat-card title="ORGANIZACIONES" [value]="organizationsTotal"
              [subtext]="'+' + organizationsPending + ' Pendientes'" icon="bi-building"
              iconBgColor="bg-primary"></app-stat-card>
          </div>
          <!-- Completed Matches -->
          <div class="col-md-4">
            <app-stat-card title="MATCHES COMPLETADOS" [value]="matchesCompleted" subtext="Voluntariados Terminados"
              icon="bi-check-circle" iconBgColor="bg-primary"></app-stat-card>
          </div>
          <!-- Completed Activities -->
          <div class="col-md-4">
            <app-stat-card title="VOLUNTARIADOS COMPLETADOS" [value]="activitiesCompleted"
              subtext="Cerrados/Finalizados" icon="bi-archive" iconBgColor="bg-primary"></app-stat-card>
          </div>
        </div>

        <!-- Bottom Section -->
        <div class="row g-4">
          <!-- Distribution of Matches -->
          <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title text-custom-blue fw-bold">Distribución de Matches</h5>
                <p class="text-muted">Estado actual de los matches</p>

                <div class="mb-3">
                  <div class="d-flex justify-content-between mb-1">
                    <span>Pendientes</span>
                    <span>{{ matchesPending }}</span>
                  </div>
                  <div class="progress" style="height: 10px;">
                    <div class="progress-bar bg-warning" role="progressbar"
                      [style.width.%]="matchesTotal > 0 ? (matchesPending / matchesTotal * 100) : 0"
                      [attr.aria-valuenow]="matchesTotal > 0 ? (matchesPending / matchesTotal * 100) : 0"
                      aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>

                <div class="mb-3">
                  <div class="d-flex justify-content-between mb-1">
                    <span>Aceptados</span>
                    <span>{{ matchesAccepted }}</span>
                  </div>
                  <div class="progress" style="height: 10px;">
                    <div class="progress-bar bg-success" role="progressbar"
                      [style.width.%]="matchesTotal > 0 ? (matchesAccepted / matchesTotal * 100) : 0"
                      [attr.aria-valuenow]="matchesTotal > 0 ? (matchesAccepted / matchesTotal * 100) : 0"
                      aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>

                <div class="mb-3">
                  <div class="d-flex justify-content-between mb-1">
                    <span>Completados</span>
                    <span>{{ matchesCompleted }}</span>
                  </div>
                  <div class="progress" style="height: 10px;">
                    <div class="progress-bar bg-info" role="progressbar"
                      [style.width.%]="matchesTotal > 0 ? (matchesCompleted / matchesTotal * 100) : 0"
                      [attr.aria-valuenow]="matchesTotal > 0 ? (matchesCompleted / matchesTotal * 100) : 0"
                      aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Information -->
          <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title text-custom-blue fw-bold">Información Rápida</h5>
                <p class="text-muted">Métricas principales</p>

                <div class="mb-4 p-3 bg-light rounded">
                  <small class="text-muted">Tasa de Aceptación</small>
                  <h3 class="text-custom-blue fw-bold mb-0">{{ acceptanceRate }}%</h3>
                </div>

                <div class="p-3 bg-light rounded">
                  <small class="text-muted">Tasa de Finalización</small>
                  <h3 class="text-custom-blue fw-bold mb-0">{{ completionRate }}%</h3>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>