<form [formGroup]="volunteerForm" autocomplete="off" class="premium-form pb-5" [class.modal-form-scroll]="isModal">
  <!-- Section: Personal Information -->
  <div class="form-section mb-5">
    <div class="d-flex align-items-center mb-3">
      <div class="section-icon me-3">
        <i class="bi bi-person-badge"></i>
      </div>
      <h4 class="fw-bold text-custom-blue mb-0">Información Personal</h4>
    </div>

    <div class="row g-4 premium-card p-3">
      <div class="col-md-6">
        <label class="premium-label"><i class="bi bi-person"></i>Nombre y Apellidos</label>
        <input type="text" class="form-control premium-input shadow-none" placeholder="Juan Pérez Rodriguez"
          formControlName="nombreCompleto">
      </div>
      <div class="col-md-6">
        <label class="premium-label"><i class="bi bi-envelope"></i>Correo Electrónico</label>
        <input type="email" class="form-control premium-input shadow-none" placeholder="juan@gmail.com"
          autocomplete="off" formControlName="correo">
      </div>
      <div class="col-md-6">
        <label class="premium-label"><i class="bi bi-card-text"></i>DNI</label>
        <input type="text" class="form-control premium-input shadow-none" placeholder="12345678M" formControlName="dni">
      </div>
      <div class="col-md-6">
        <label class="premium-label"><i class="bi bi-lock"></i>Contraseña</label>
        <input type="password" class="form-control premium-input shadow-none" placeholder="Contraseña"
          autocomplete="new-password" formControlName="password">
      </div>
      <div class="col-md-6">
        <label class="premium-label"><i class="bi bi-geo-alt"></i>Zona</label>
        <select class="form-select premium-input shadow-none" formControlName="zona">
          <option value="" disabled selected>Selecciona una zona...</option>
          <option *ngFor="let zone of availableZones" [value]="zone">{{ zone }}</option>
        </select>
      </div>
      <div class="col-md-6">
        <label class="premium-label"><i class="bi bi-translate"></i>Idiomas</label>
        <div class="d-flex gap-2">
          <select class="form-select premium-input shadow-none" [(ngModel)]="selectedIdioma"
            [ngModelOptions]="{standalone: true}">
            <option value="" disabled selected>Añadir idioma...</option>
            <option *ngFor="let lang of availableLanguages" [value]="lang" [disabled]="addedIdiomas.includes(lang)">
              {{ lang }}
            </option>
          </select>
          <button type="button"
            class="btn btn-custom-blue text-white rounded-3 px-3 d-flex align-items-center justify-content-center"
            (click)="addItem('idiomas', selectedIdioma)" style="min-width: 48px;">
            <i class="bi bi-plus-lg fs-5"></i>
          </button>
        </div>
      </div>

      <div class="col-12 mt-4 pt-3 border-top">
        <div class="row g-4">
          <div class="col-md-3">
            <label class="premium-label"><i class="bi bi-mortarboard"></i>Ciclo</label>
            <select class="form-select premium-input shadow-none" formControlName="ciclo">
              <option value="" disabled selected>Selecciona tu ciclo...</option>
              <option *ngFor="let c of availableCiclos" [value]="c.nombre">{{ c.nombre }}</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="premium-label"><i class="bi bi-briefcase"></i>Experiencia</label>
            <select class="form-select premium-input shadow-none" formControlName="experiencia">
              <option value="Sin experiencia">Sin experiencia</option>
              <option value="< 1 año">Menos de 1 año</option>
              <option value="1-3 años">1-3 años</option>
              <option value="> 3 años">Más de 3 años</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="premium-label"><i class="bi bi-car-front"></i>Coche</label>
            <select class="form-select premium-input shadow-none" formControlName="coche">
              <option value="Si">Si</option>
              <option value="No">No</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="premium-label"><i class="bi bi-calendar-event"></i>Nacimiento</label>
            <input type="date" class="form-control premium-input shadow-none" formControlName="fechaNacimiento">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Section: Skills and Interests -->
  <div class="form-section mb-5">
    <div class="d-flex align-items-center mb-3">
      <div class="section-icon me-3">
        <i class="bi bi-stars"></i>
      </div>
      <h4 class="fw-bold text-custom-blue mb-0">Habilidades e Intereses</h4>
    </div>

    <div class="premium-card p-0 overflow-hidden">
      <div class="p-4 border-bottom bg-light bg-opacity-50">
        <h5 class="fw-bold text-custom-blue mb-3">Habilidades</h5>
        <div class="d-flex flex-wrap gap-2">
          <span *ngFor="let skill of availableSkills"
            class="badge skill-tag px-3 py-2 rounded-pill fw-normal d-flex align-items-center gap-2 pointer-cursor hover-lift"
            [ngClass]="{'unselected': !isAdded('habilidades', skill), 'bg-custom-blue text-white shadow-sm': isAdded('habilidades', skill)}"
            (click)="isAdded('habilidades', skill) ? removeItem('habilidades', skill) : addItem('habilidades', skill)">
            {{ skill.nombre }}
            <i class="bi"
              [ngClass]="{'bi-plus-lg': !isAdded('habilidades', skill), 'bi-check-lg': isAdded('habilidades', skill)}"></i>
          </span>
        </div>
      </div>

      <div class="p-4 bg-white">
        <h5 class="fw-bold text-custom-blue mb-3">Intereses</h5>
        <div class="d-flex flex-wrap gap-2">
          <!-- CORRECCIÓN: Estilo mejorado para mejor visibilidad de intereses no seleccionados -->
          <span *ngFor="let interest of availableInterests"
            class="badge interest-tag px-3 py-2 rounded-pill fw-normal d-flex align-items-center gap-2 pointer-cursor hover-lift"
            [ngClass]="{'unselected-interest': !isAdded('intereses', interest), 'selected-interest bg-warning text-black shadow-sm': isAdded('intereses', interest)}"
            (click)="isAdded('intereses', interest) ? removeItem('intereses', interest) : addItem('intereses', interest)">
            {{ interest.nombre }}
            <i class="bi fst-normal"
              [ngClass]="{'bi-plus-lg': !isAdded('intereses', interest), 'bi-check-lg': isAdded('intereses', interest)}"></i>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Section: Availability -->
  <div class="form-section mb-5">
    <div class="d-flex align-items-center mb-3">
      <div class="section-icon me-3">
        <i class="bi bi-clock-history"></i>
      </div>
      <h4 class="fw-bold text-custom-blue mb-0">Disponibilidad</h4>
    </div>

    <div class="premium-card p-4">
      <div class="row g-3 align-items-end">
        <div class="col-md-5">
          <label class="premium-label"><i class="bi bi-calendar3"></i>Día de la semana</label>
          <select class="form-select premium-input shadow-none" [(ngModel)]="selectedDay"
            [ngModelOptions]="{standalone: true}">
            <option value="" disabled>Selecciona día...</option>
            <option *ngFor="let d of availableDays" [value]="d">{{ d }}</option>
          </select>
        </div>
        <div class="col-md-5">
          <label class="premium-label"><i class="bi bi-clock"></i>Turno / Horario</label>
          <select class="form-select premium-input shadow-none" [(ngModel)]="selectedSlot"
            [ngModelOptions]="{standalone: true}">
            <option value="" disabled>Selecciona turno...</option>
            <option *ngFor="let s of availableSlots" [value]="s">{{ s }}</option>
          </select>
        </div>
        <div class="col-md-2">
          <button type="button"
            class="btn btn-custom-blue text-white w-100 rounded-3 py-2 d-flex align-items-center justify-content-center"
            [disabled]="!canAddAvailability" (click)="addItem('disponibilidad', null)" style="height: 48px;">
            <i class="bi bi-plus-lg fs-4"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Section: Review Summary -->
  <div class="form-section mb-4 mt-5">
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden review-card">
      <div class="card-header bg-custom-blue text-white py-3 px-4 d-flex align-items-center">
        <i class="bi bi-check2-circle fs-4 me-2"></i>
        <h5 class="fw-bold mb-0">Resumen de tu Perfil</h5>
      </div>
      <div class="card-body p-4 bg-light bg-opacity-25">
        <div class="d-flex gap-2 flex-wrap min-vh-5 align-items-center">
          <span *ngFor="let lang of addedIdiomas"
            class="badge summary-badge lang-badge px-3 py-2 rounded-pill fw-normal d-flex align-items-center gap-2 pointer-cursor shadow-sm"
            (click)="removeItem('idiomas', lang)" title="Click para eliminar">
            <i class="bi bi-translate"></i> {{ lang }} <i class="bi bi-x fs-5 text-danger ms-1"></i>
          </span>
          <span *ngFor="let skill of addedSkills"
            class="badge summary-badge skill-badge-added px-3 py-2 rounded-pill fw-normal d-flex align-items-center gap-2 pointer-cursor shadow-sm"
            (click)="removeItem('habilidades', skill)" title="Click para eliminar">
            <i class="bi bi-gear"></i> {{ skill.nombre }} <i class="bi bi-x fs-5 ms-1"></i>
          </span>
          <span *ngFor="let interest of addedInterests"
            class="badge summary-badge interest-badge-added px-3 py-2 rounded-pill fw-normal d-flex align-items-center gap-2 pointer-cursor shadow-sm"
            (click)="removeItem('intereses', interest)" title="Click para eliminar">
            <i class="bi bi-heart"></i> {{ interest.nombre }} <i class="bi bi-x fs-5 ms-1"></i>
          </span>
          <span *ngFor="let availability of addedAvailability"
            class="badge summary-badge availability-badge-added px-3 py-2 rounded-pill fw-normal d-flex align-items-center gap-2 pointer-cursor shadow-sm"
            (click)="removeItem('disponibilidad', availability)" title="Click para eliminar">
            <i class="bi bi-clock"></i> {{ availability }} <i class="bi bi-x fs-5 ms-1"></i>
          </span>
          <div
            *ngIf="addedSkills.length === 0 && addedInterests.length === 0 && addedAvailability.length === 0 && addedIdiomas.length === 0"
            class="text-muted d-flex align-items-center p-3 w-100 justify-content-center border border-dashed rounded-3">
            <i class="bi bi-info-circle me-2"></i>
            <span class="fst-italic">Añade habilidades e intereses para completar tu perfil...</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Messages and Submit -->
  <div *ngIf="errorMessage" class="mb-4">
    <div class="alert alert-danger px-4 py-3 rounded-4 shadow-sm border-0 d-flex align-items-center" role="alert">
      <i class="bi bi-exclamation-octagon-fill fs-4 me-3"></i>
      <span style="white-space: pre-line;">{{ errorMessage }}</span>
    </div>
  </div>

  <div class="text-center pt-4 pb-2">
    <button type="button" (click)="onRegister()"
      class="btn btn-custom-blue px-4 py-2 rounded-pill text-white shadow-lg hover-lift submit-btn">
      <i class="bi bi-check-lg me-2"></i> {{ submitLabel }}
    </button>
  </div>
</form>